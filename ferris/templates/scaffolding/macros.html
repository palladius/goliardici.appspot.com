{% import 'macros/pagination.html' as pagination with context %}


{#
    Chooses either the admin layout or the default layout depending
    on the prefix of the handler.
#}
{% macro admin_or_default() -%}
    {% if handler.prefix == 'admin' -%}
        layouts/admin.html
    {%- else -%}
        layouts/default.html
    {%- endif %}
{%- endmacro %}


{#
    Pretty print values. This is useful for printing model
    data. Sequences are printed as unordered lists, dates
    are localized.
#}
{% macro print_value(value) -%}
    {% if (value is sequence and not value is string) or (isinstance(value, (db.Query, ndb.Query))): %}
        <ul>
        {% for item in value %}
            <li>{{print_value(item)}}</li>
        {% endfor %}
        </ul>
    {% elif value is datetime: %}
        {{localize(value).strftime('%b %d, %Y at %I:%M%p %Z')}}
    {% elif isinstance(value, datetime.date): %}
        {{value.strftime('%b %d, %Y')}}
    {% elif isinstance(value, ndb.Key) %}
        {{value.get()}}
    {% else %}
        {{value}}
    {% endif %}
{%- endmacro %}

{% set print = print_value %}


{#
    Includes {{handler.name}}/{{template}} and falls back to
    scaffolding/{{template}}
#}
{% macro override_include(template) -%}
{% include [handler.name+'/'+template,'scaffolding/'+template] %}
{%- endmacro %}


{#
    Creates a uri for the current handler with a given action.
#}
{% macro action_uri(action) -%}
    {{ handler.uri(action=action,*varargs,**kwargs) }}
{%- endmacro %}


{#
    Flash messages from the session.
#}
{% macro flash() -%}
    {% set flashes = handler.session.pop('__flash',None) %}
    {% if flashes %}
        {% for flash in flashes %}
            <div class="alert alert-{{flash[1]}}">
              <button type="button" class="close" data-dismiss="alert">Ã—</button>
              {{flash[0]}}
            </div>
        {% endfor %}
    {% endif %}
{%- endmacro %}


{#
    Inserts pagination logic
#}
{% macro next_page_link() -%}
    {{pagination.next_page_link(*args,**kwargs)}}
{%- endmacro %}



{#
    Generates a single action button for an item
#}
{% macro action_button(item, action, icon, btn, class=None, confirm=False): -%}
    {% if handler.uri_exists(action=action) %}
        <a
            href='{{ action_uri(action,id=scaffolding.url_id_for(item)) }}'
            class='btn {{btn}} {{class}}'
            rel="tooltip"
            title='{{inflector.titleize(action)}}'
            {% if confirm: %}
            onclick='javascript: return confirm("Are you sure you want to delete this item?");'
            {% endif %}>
            <i class="{{icon}} icon-white"></i>
        </a>
    {% endif %}
{%- endmacro %}


{#
    Generates the standard suite of action buttons for an item (view, edit, delete)
#}
{% macro action_buttons(item, class=None) -%}
<div class='btn-group'>
    {% set class = class or ''%}
    {{action_button(item, 'view', 'icon-search', 'btn-success', class)}}
    {{action_button(item, 'edit', 'icon-pencil', 'btn-primary', class)}}
    {{action_button(item, 'delete', 'icon-trash', 'btn-danger', class)}}
</div>
{%- endmacro %}

{#
    Generates a link for the sidebar
#}
{% macro nav_link(title, action, icon): -%}
    {% if handler.uri_exists(action=action) %}
        {% if handler.action == action %}
            {% set active = True %}
        {% else %}
            {% set active = False %}
        {% endif %}
        <li {% if active %}class='active'{% endif %}>
            <a href="{{action_uri(action, **kwargs)}}">
                <i class="{{icon}} {% if active %}icon-white{% endif %}"></i>
                {{title}}
            </a>
        </li>
    {% endif %}
{%- endmacro %}
